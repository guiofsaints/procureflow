# Technology Stack

Complete technology stack with versions, decision rationale, and trade-offs.

For complete stack details and decision log, see: [`.guided/architecture/stack-and-patterns.md`](https://github.com/guiofsaints/procureflow/blob/main/.guided/architecture/stack-and-patterns.md)

## Executive Summary

ProcureFlow uses Next.js 15 (App Router), React 19, TypeScript 5.7, MongoDB/Mongoose, LangChain + OpenAI GPT-3.5-turbo, NextAuth.js, Tailwind CSS + Radix UI, Vitest, Winston logging, and Pulumi for GCP infrastructure. Stack optimized for rapid development, cost efficiency (< $50/month), and AI-first workflows.

---

## Quick Reference

### Frontend Stack

| Technology       | Version | Purpose                           |
| ---------------- | ------- | --------------------------------- |
| **React**        | 19.2.0  | UI library with Server Components |
| **Next.js**      | 15.1.4  | Full-stack framework (App Router) |
| **TypeScript**   | 5.7.3   | Type safety and IDE support       |
| **Tailwind CSS** | 3.4.1   | Utility-first styling             |
| **Radix UI**     | 1.1.4   | Accessible component primitives   |
| **Lucide React** | 0.553.0 | Icon library (tree-shakeable)     |

### Backend Stack

| Technology      | Version | Purpose                            |
| --------------- | ------- | ---------------------------------- |
| **Node.js**     | 20.19.4 | JavaScript runtime                 |
| **Mongoose**    | 8.9.4   | MongoDB ODM with schema validation |
| **NextAuth.js** | 4.24.11 | Authentication with JWT sessions   |
| **Zod**         | 4.1.12  | Runtime schema validation          |
| **bcryptjs**    | 3.0.3   | Password hashing                   |

### AI & Agent Stack

| Technology     | Version       | Purpose                               |
| -------------- | ------------- | ------------------------------------- |
| **LangChain**  | 0.3.19        | LLM orchestration framework           |
| **OpenAI SDK** | 4.77.0        | GPT-3.5-turbo client                  |
| **Model**      | GPT-3.5-turbo | Cost-efficient LLM ($0.002/1K tokens) |

### Data & Testing Stack

| Technology                | Version      | Purpose                       |
| ------------------------- | ------------ | ----------------------------- |
| **MongoDB Atlas**         | M0 Free Tier | Document database (512 MB)    |
| **Vitest**                | 4.0.8        | Test runner (Jest-compatible) |
| **Testing Library**       | 16.3.0       | Component testing             |
| **mongodb-memory-server** | 10.3.0       | In-memory DB for tests        |

### Infrastructure Stack

| Technology         | Version | Purpose                             |
| ------------------ | ------- | ----------------------------------- |
| **Pulumi**         | 3.145.0 | Infrastructure as Code (TypeScript) |
| **GCP Cloud Run**  | N/A     | Serverless container platform       |
| **Docker**         | N/A     | Container runtime                   |
| **GitHub Actions** | N/A     | CI/CD pipeline                      |

---

## Key Technology Decisions

### Why Next.js 15?

**Rationale**:

- App Router with React Server Components
- File-based routing + API routes in same codebase
- Excellent developer experience
- Easy deployment (Vercel/GCP)

**Alternatives Considered**:

- Remix (strong, but smaller ecosystem)
- Create React App (no SSR/API routes)
- Express + React (more setup)

### Why MongoDB?

**Rationale**:

- Schema flexibility for varying catalog fields
- Built-in full-text search for catalog
- Document model fits cart items, PR snapshots
- Atlas M0 free tier (512 MB)

**Alternatives Considered**:

- PostgreSQL (less suitable for nested documents)
- Supabase (less generous free tier)
- Firebase Firestore (vendor lock-in)

### Why LangChain + OpenAI?

**Rationale**:

- Function calling abstractions
- Conversation memory management
- Multi-provider support (OpenAI, Gemini fallback)
- GPT-3.5-turbo: Fast (< 2s) + cheap ($0.002/1K tokens)

**Alternatives Considered**:

- GPT-4 (more expensive, slower)
- Gemini (no function calling in free tier)
- Direct OpenAI SDK (no abstractions)

### Why Pulumi?

**Rationale**:

- TypeScript IaC (same language as app)
- State management included
- Preview before deploy
- GCP provider support

**Alternatives Considered**:

- Terraform (HCL not TypeScript)
- AWS CDK (AWS-only)
- Manual GCP console (no versioning)

---

## Technology Constraints

### Cost Constraints

| Service           | Free Tier Limit                    | Impact                                 |
| ----------------- | ---------------------------------- | -------------------------------------- |
| **GCP Cloud Run** | 2M requests/month, 360k GB-seconds | Forces min instances = 0 (cold starts) |
| **MongoDB M0**    | 512 MB, 500 connections            | Limits data size + horizontal scaling  |
| **OpenAI API**    | No free tier                       | Rate limiting + budget alerts required |

**Total Monthly Cost**: ~$2 (OpenAI usage only)

### Performance Constraints

- **Cold Starts**: 2-3s when scaling from 0 (Cloud Run)
- **MongoDB Connections**: 500 max = ~10 Cloud Run instances limit
- **Text Index**: Must be created manually (not automatic)

### Development Constraints

- **Node.js 20**: LTS version, no cutting-edge features
- **TypeScript Strict Mode**: All code must pass strict checks
- **ESLint + Prettier**: All code must pass linting/formatting

---

## Version Policy

### Update Frequency

- **Major versions**: Evaluate quarterly (breaking changes)
- **Minor versions**: Update monthly (new features)
- **Patch versions**: Update weekly (bug fixes, security)

### Locked Dependencies

Critical dependencies locked to specific versions:

```json
{
  "next": "15.1.4",
  "react": "19.2.0",
  "mongoose": "8.9.4",
  "langchain": "0.3.19"
}
```

### Flexible Dependencies

Allow patch updates for non-critical packages:

```json
{
  "zod": "^4.1.12",
  "winston": "^3.18.3"
}
```

---

## References

- **[Design Patterns](/tech/patterns)** - Architectural patterns
- **[Infrastructure](/tech/infrastructure)** - Deployment details
- **[C4 Container Diagram](/tech/c4/container)** - Technology mapping

**Complete Stack Details**: [`.guided/architecture/stack-and-patterns.md`](https://github.com/guiofsaints/procureflow/blob/main/.guided/architecture/stack-and-patterns.md)

---

**Last Updated**: 2025-11-12  
**Owner**: Architecture Team
