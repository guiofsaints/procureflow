[
  {
    "id": "TS-001",
    "title": "Enable noImplicitAny in tsconfig",
    "files": ["packages/web/tsconfig.json"],
    "domain": "ts",
    "severity": "critical",
    "effort": "medium",
    "wave": 1,
    "acceptance": "tsconfig has noImplicitAny: true, all implicit any errors fixed"
  },
  {
    "id": "TS-002",
    "title": "Enable strictNullChecks in tsconfig",
    "files": ["packages/web/tsconfig.json"],
    "domain": "ts",
    "severity": "critical",
    "effort": "high",
    "wave": 1,
    "acceptance": "tsconfig has strictNullChecks: true, all null/undefined errors fixed"
  },
  {
    "id": "TS-003",
    "title": "Enable full strict mode in tsconfig",
    "files": ["packages/web/tsconfig.json"],
    "domain": "ts",
    "severity": "critical",
    "effort": "medium",
    "wave": 1,
    "acceptance": "tsconfig has strict: true, pnpm tsc --noEmit succeeds"
  },
  {
    "id": "BC-001",
    "title": "Remove ignoreBuildErrors from next.config",
    "files": ["packages/web/next.config.mjs"],
    "domain": "nextjs",
    "severity": "critical",
    "effort": "low",
    "wave": 1,
    "acceptance": "ignoreBuildErrors: false, pnpm build succeeds with zero TS errors"
  },
  {
    "id": "TS-004",
    "title": "Fix tsc out-of-memory issue",
    "files": ["package.json", "packages/web/tsconfig.json"],
    "domain": "ts",
    "severity": "critical",
    "effort": "medium",
    "wave": 1,
    "acceptance": "pnpm tsc --noEmit completes without OOM, add --max-old-space-size if needed"
  },
  {
    "id": "TS-005",
    "title": "Create typed Mongoose document interfaces (Cart)",
    "files": ["packages/web/src/lib/db/types/cart.types.ts"],
    "domain": "ts",
    "severity": "critical",
    "effort": "medium",
    "wave": 1,
    "acceptance": "CartDocument interface created with proper Types.ObjectId"
  },
  {
    "id": "TS-006",
    "title": "Create typed Mongoose document interfaces (Item)",
    "files": ["packages/web/src/lib/db/types/item.types.ts"],
    "domain": "ts",
    "severity": "critical",
    "effort": "low",
    "wave": 1,
    "acceptance": "ItemDocument interface created"
  },
  {
    "id": "TS-007",
    "title": "Create typed Mongoose document interfaces (PurchaseRequest)",
    "files": ["packages/web/src/lib/db/types/purchase-request.types.ts"],
    "domain": "ts",
    "severity": "critical",
    "effort": "medium",
    "wave": 1,
    "acceptance": "PurchaseRequestDocument interface created"
  },
  {
    "id": "TS-008",
    "title": "Create typed Mongoose document interfaces (Conversation)",
    "files": ["packages/web/src/lib/db/types/conversation.types.ts"],
    "domain": "ts",
    "severity": "critical",
    "effort": "medium",
    "wave": 1,
    "acceptance": "AgentConversationDocument interface created"
  },
  {
    "id": "DUP-001",
    "title": "Create shared cart mapper utility",
    "files": ["packages/web/src/lib/db/mappers/cart.mapper.ts"],
    "domain": "core",
    "severity": "critical",
    "effort": "medium",
    "wave": 2,
    "acceptance": "mapCartDocumentToEntity() created with full type safety, no any types"
  },
  {
    "id": "DUP-002",
    "title": "Create shared item mapper utility",
    "files": ["packages/web/src/lib/db/mappers/item.mapper.ts"],
    "domain": "core",
    "severity": "high",
    "effort": "low",
    "wave": 2,
    "acceptance": "mapItemDocumentToEntity() created"
  },
  {
    "id": "DUP-003",
    "title": "Create shared purchase request mapper utility",
    "files": ["packages/web/src/lib/db/mappers/purchase-request.mapper.ts"],
    "domain": "core",
    "severity": "high",
    "effort": "medium",
    "wave": 2,
    "acceptance": "mapPurchaseRequestDocumentToEntity() created"
  },
  {
    "id": "DUP-004",
    "title": "Create shared conversation mapper utility",
    "files": ["packages/web/src/lib/db/mappers/conversation.mapper.ts"],
    "domain": "core",
    "severity": "high",
    "effort": "medium",
    "wave": 2,
    "acceptance": "mapConversationDocumentToEntity() created"
  },
  {
    "id": "TS-009",
    "title": "Replace any types in cart.service.ts",
    "files": ["packages/web/src/features/cart/lib/cart.service.ts"],
    "domain": "ts",
    "severity": "critical",
    "effort": "high",
    "wave": 1,
    "acceptance": "Zero any types, use CartDocument and mappers, all ESLint suppressions removed"
  },
  {
    "id": "TS-010",
    "title": "Replace any types in checkout.service.ts",
    "files": ["packages/web/src/features/checkout/lib/checkout.service.ts"],
    "domain": "ts",
    "severity": "critical",
    "effort": "high",
    "wave": 1,
    "acceptance": "Zero any types, use mappers, all ESLint suppressions removed"
  },
  {
    "id": "TS-011",
    "title": "Replace any types in agent.service.ts",
    "files": ["packages/web/src/features/agent/lib/agent.service.ts"],
    "domain": "ts",
    "severity": "critical",
    "effort": "medium",
    "wave": 1,
    "acceptance": "Zero any types in message mapping logic"
  },
  {
    "id": "RH-001",
    "title": "Fix useAgentConversations missing dependency",
    "files": ["packages/web/src/features/agent/hooks/useAgentConversations.ts"],
    "domain": "react",
    "severity": "high",
    "effort": "low",
    "wave": 1,
    "acceptance": "fetchConversations wrapped in useCallback, added to deps array, no stale closures"
  },
  {
    "id": "RH-002",
    "title": "Audit exhaustive-deps suppressions",
    "files": [
      "packages/web/src/features/checkout/components/PurchaseRequestDetailPageContent.tsx",
      "packages/web/src/features/checkout/components/PurchaseHistoryPageContent.tsx"
    ],
    "domain": "react",
    "severity": "medium",
    "effort": "low",
    "wave": 1,
    "acceptance": "All suppressions reviewed, either fixed or justified with comment"
  },
  {
    "id": "RH-003",
    "title": "Enable react-hooks/exhaustive-deps as error",
    "files": ["packages/web/eslint.config.mjs"],
    "domain": "react",
    "effort": "low",
    "wave": 1,
    "acceptance": "ESLint rule upgraded to error, no violations"
  },
  {
    "id": "NX-001",
    "title": "Add error.tsx to catalog route",
    "files": ["packages/web/src/app/(app)/catalog/error.tsx"],
    "domain": "nextjs",
    "severity": "high",
    "effort": "low",
    "wave": 1,
    "acceptance": "Error boundary renders, logs to winston, displays user-friendly message"
  },
  {
    "id": "NX-002",
    "title": "Add error.tsx to cart route",
    "files": ["packages/web/src/app/(app)/cart/error.tsx"],
    "domain": "nextjs",
    "severity": "high",
    "effort": "low",
    "wave": 1,
    "acceptance": "Error boundary renders"
  },
  {
    "id": "NX-003",
    "title": "Add error.tsx to purchase route",
    "files": ["packages/web/src/app/(app)/purchase/error.tsx"],
    "domain": "nextjs",
    "severity": "high",
    "effort": "low",
    "wave": 1,
    "acceptance": "Error boundary renders"
  },
  {
    "id": "NX-004",
    "title": "Add error.tsx to settings route",
    "files": ["packages/web/src/app/(app)/settings/error.tsx"],
    "domain": "nextjs",
    "severity": "high",
    "effort": "low",
    "wave": 1,
    "acceptance": "Error boundary renders"
  },
  {
    "id": "NX-005",
    "title": "Add error.tsx to agent route",
    "files": ["packages/web/src/app/(app)/agent/error.tsx"],
    "domain": "nextjs",
    "severity": "high",
    "effort": "low",
    "wave": 1,
    "acceptance": "Error boundary renders"
  },
  {
    "id": "NX-006",
    "title": "Add global error boundary",
    "files": ["packages/web/src/app/error.tsx"],
    "domain": "nextjs",
    "severity": "high",
    "effort": "low",
    "wave": 1,
    "acceptance": "Root-level error boundary catches all unhandled errors"
  },
  {
    "id": "NX-007",
    "title": "Add loading.tsx to catalog route",
    "files": ["packages/web/src/app/(app)/catalog/loading.tsx"],
    "domain": "nextjs",
    "severity": "medium",
    "effort": "low",
    "wave": 1,
    "acceptance": "Skeleton displays during data fetch"
  },
  {
    "id": "NX-008",
    "title": "Add loading.tsx to purchase route",
    "files": ["packages/web/src/app/(app)/purchase/loading.tsx"],
    "domain": "nextjs",
    "severity": "medium",
    "effort": "low",
    "wave": 1,
    "acceptance": "Skeleton displays during data fetch"
  },
  {
    "id": "NX-009",
    "title": "Add loading.tsx to cart route",
    "files": ["packages/web/src/app/(app)/cart/loading.tsx"],
    "domain": "nextjs",
    "severity": "medium",
    "effort": "low",
    "wave": 1,
    "acceptance": "Skeleton displays during data fetch"
  },
  {
    "id": "DUP-005",
    "title": "Create centralized API error handler",
    "files": ["packages/web/src/lib/api/errorHandler.ts"],
    "domain": "api",
    "severity": "high",
    "effort": "medium",
    "wave": 2,
    "acceptance": "handleApiError() utility created with correlation IDs and winston logging"
  },
  {
    "id": "DUP-006",
    "title": "Refactor route handlers to use handleApiError",
    "files": ["packages/web/src/app/(app)/api/**/route.ts"],
    "domain": "api",
    "severity": "high",
    "effort": "high",
    "wave": 2,
    "acceptance": "All 40+ route handlers use shared error handler, zero console.error calls"
  },
  {
    "id": "DUP-007",
    "title": "Create withAuth HOF utility",
    "files": ["packages/web/src/lib/api/withAuth.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "medium",
    "wave": 2,
    "acceptance": "withAuth() wraps handlers, extracts session, injects userId"
  },
  {
    "id": "DUP-008",
    "title": "Refactor protected routes to use withAuth",
    "files": ["packages/web/src/app/(app)/api/**/route.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "high",
    "wave": 2,
    "acceptance": "30+ routes use withAuth, no getServerSession() boilerplate"
  },
  {
    "id": "DUP-009",
    "title": "Create validateRequestBody utility",
    "files": ["packages/web/src/lib/api/validateRequest.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "low",
    "wave": 2,
    "acceptance": "Zod validation wrapper with consistent error responses"
  },
  {
    "id": "DUP-010",
    "title": "Refactor POST routes to use validateRequestBody",
    "files": ["packages/web/src/app/(app)/api/**/route.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "medium",
    "wave": 2,
    "acceptance": "20+ routes use shared validation, consistent error schema"
  },
  {
    "id": "CMPLX-001",
    "title": "Extract agent tool definitions to separate file",
    "files": ["packages/web/src/features/agent/lib/agent-tools.ts"],
    "domain": "core",
    "severity": "high",
    "effort": "medium",
    "wave": 2,
    "acceptance": "agent-tools.ts created, ~400 LOC, exported tool schemas"
  },
  {
    "id": "CMPLX-002",
    "title": "Extract agent mappers to separate file",
    "files": ["packages/web/src/features/agent/lib/agent-mappers.ts"],
    "domain": "core",
    "severity": "medium",
    "effort": "low",
    "wave": 2,
    "acceptance": "agent-mappers.ts created, ~150 LOC"
  },
  {
    "id": "CMPLX-003",
    "title": "Extract conversation title generator",
    "files": ["packages/web/src/features/agent/lib/conversation-title-generator.ts"],
    "domain": "core",
    "severity": "low",
    "effort": "low",
    "wave": 2,
    "acceptance": "conversation-title-generator.ts created, ~100 LOC"
  },
  {
    "id": "CMPLX-004",
    "title": "Refactor agent.service.ts to use extracted modules",
    "files": ["packages/web/src/features/agent/lib/agent.service.ts"],
    "domain": "core",
    "severity": "high",
    "effort": "high",
    "wave": 2,
    "acceptance": "agent.service.ts <500 LOC, imports from extracted modules"
  },
  {
    "id": "API-001",
    "title": "Implement PUT /api/items/:id endpoint",
    "files": [
      "packages/web/src/app/(app)/api/items/[id]/route.ts",
      "packages/web/src/features/catalog/lib/catalog.service.ts"
    ],
    "domain": "api",
    "severity": "medium",
    "effort": "medium",
    "wave": 2,
    "acceptance": "updateItem() service function created, PUT handler returns 200"
  },
  {
    "id": "API-002",
    "title": "Enable item update UI (remove TODO)",
    "files": [
      "packages/web/src/features/catalog/components/item-mutate-dialog.tsx",
      "packages/web/src/features/catalog/components/item-mutate-drawer.tsx"
    ],
    "domain": "react",
    "severity": "medium",
    "effort": "low",
    "wave": 2,
    "acceptance": "Update button works, calls PUT endpoint, TODO comments removed"
  },
  {
    "id": "API-003",
    "title": "Standardize error response schema across all routes",
    "files": ["packages/web/src/app/(app)/api/**/route.ts"],
    "domain": "api",
    "severity": "high",
    "effort": "medium",
    "wave": 2,
    "acceptance": "All errors return {success, error{code, message, correlationId, timestamp}}"
  },
  {
    "id": "API-004",
    "title": "Fix status codes (201 for POST, 404 for missing)",
    "files": ["packages/web/src/app/(app)/api/**/route.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "low",
    "wave": 2,
    "acceptance": "POST returns 201, missing resources return 404"
  },
  {
    "id": "API-005",
    "title": "Add cursor-based pagination to catalog search",
    "files": [
      "packages/web/src/features/catalog/lib/catalog.service.ts",
      "packages/web/src/app/(app)/api/items/route.ts"
    ],
    "domain": "api",
    "severity": "medium",
    "effort": "high",
    "wave": 2,
    "acceptance": "Pagination with cursor, hasMore, nextCursor in response"
  },
  {
    "id": "API-006",
    "title": "Add filtering & sorting to catalog",
    "files": ["packages/web/src/features/catalog/lib/catalog.service.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "medium",
    "wave": 2,
    "acceptance": "Filter by category, price range; sort by name, price, date"
  },
  {
    "id": "TEST-001",
    "title": "Setup Vitest + Testing Library",
    "files": ["packages/web/vitest.config.ts", "package.json"],
    "domain": "core",
    "severity": "medium",
    "effort": "low",
    "wave": 3,
    "acceptance": "pnpm test runs, coverage reporting configured"
  },
  {
    "id": "TEST-002",
    "title": "Add unit tests for cart mapper",
    "files": ["packages/web/src/lib/db/mappers/cart.mapper.test.ts"],
    "domain": "core",
    "severity": "high",
    "effort": "low",
    "wave": 3,
    "acceptance": "100% coverage of mapper functions"
  },
  {
    "id": "TEST-003",
    "title": "Add unit tests for catalog service",
    "files": ["packages/web/src/features/catalog/lib/catalog.service.test.ts"],
    "domain": "core",
    "severity": "high",
    "effort": "medium",
    "wave": 3,
    "acceptance": "80%+ coverage of service functions"
  },
  {
    "id": "TEST-004",
    "title": "Add integration tests for API routes",
    "files": ["packages/web/src/app/(app)/api/__tests__/items.test.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "high",
    "wave": 3,
    "acceptance": "60%+ coverage of route handlers, mock MongoDB"
  },
  {
    "id": "TEST-005",
    "title": "Add E2E tests for critical flows",
    "files": ["packages/web/tests/e2e/checkout-flow.spec.ts"],
    "domain": "core",
    "severity": "medium",
    "effort": "high",
    "wave": 3,
    "acceptance": "Search → add to cart → checkout flow tested end-to-end"
  },
  {
    "id": "OBS-001",
    "title": "Add request ID middleware",
    "files": ["packages/web/middleware.ts"],
    "domain": "core",
    "severity": "medium",
    "effort": "low",
    "wave": 3,
    "acceptance": "All requests have unique ID in headers and logs"
  },
  {
    "id": "OBS-002",
    "title": "Enhance Prometheus metrics",
    "files": ["packages/web/src/lib/metrics/prometheus.config.ts"],
    "domain": "core",
    "severity": "medium",
    "effort": "medium",
    "wave": 3,
    "acceptance": "Business metrics (carts, checkouts) and DB query time tracked"
  },
  {
    "id": "OBS-003",
    "title": "Integrate error tracking (Sentry)",
    "files": ["packages/web/sentry.config.ts"],
    "domain": "core",
    "severity": "medium",
    "effort": "medium",
    "wave": 3,
    "acceptance": "Errors sent to Sentry with source maps"
  },
  {
    "id": "PERF-001",
    "title": "Add React.memo to expensive components",
    "files": ["packages/web/src/features/agent/components/AgentProductCard.tsx"],
    "domain": "react",
    "severity": "low",
    "effort": "low",
    "wave": 3,
    "acceptance": "Profile with React DevTools, add memo if re-render count high"
  },
  {
    "id": "PERF-002",
    "title": "Add database indexes",
    "files": ["packages/web/src/lib/db/schemas/*"],
    "domain": "core",
    "severity": "medium",
    "effort": "low",
    "wave": 3,
    "acceptance": "Indexes on userId, itemId, createdAt fields"
  },
  {
    "id": "PERF-003",
    "title": "Add Cache-Control headers to API routes",
    "files": ["packages/web/src/app/(app)/api/**/route.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "low",
    "wave": 3,
    "acceptance": "Catalog routes cached 1h, user routes private no-cache"
  },
  {
    "id": "PERF-004",
    "title": "Optimize bundle size",
    "files": ["packages/web/next.config.mjs"],
    "domain": "nextjs",
    "severity": "low",
    "effort": "medium",
    "wave": 3,
    "acceptance": "Bundle <500KB, Lighthouse score >90"
  },
  {
    "id": "DOC-001",
    "title": "Add JSDoc to all public service functions",
    "files": ["packages/web/src/features/**/lib/*.service.ts"],
    "domain": "core",
    "severity": "low",
    "effort": "low",
    "wave": 3,
    "acceptance": "All exported functions have JSDoc with @param and @returns"
  },
  {
    "id": "DOC-002",
    "title": "Auto-generate OpenAPI from Zod schemas",
    "files": [
      "packages/web/src/lib/openapi.ts",
      "packages/web/src/lib/openapi-generator.ts"
    ],
    "domain": "api",
    "severity": "medium",
    "effort": "medium",
    "wave": 3,
    "acceptance": "OpenAPI spec generated from Zod, served at /api/docs"
  },
  {
    "id": "DOC-003",
    "title": "Update README with architecture notes",
    "files": ["README.md"],
    "domain": "core",
    "severity": "low",
    "effort": "low",
    "wave": 3,
    "acceptance": "README explains service layer, mappers, API patterns"
  },
  {
    "id": "NX-010",
    "title": "Add metadata exports to all pages",
    "files": ["packages/web/src/app/(app)/**/page.tsx"],
    "domain": "nextjs",
    "severity": "low",
    "effort": "low",
    "wave": 3,
    "acceptance": "All pages have metadata for title and description"
  },
  {
    "id": "NX-011",
    "title": "Add next/font optimization",
    "files": ["packages/web/src/app/layout.tsx"],
    "domain": "nextjs",
    "severity": "low",
    "effort": "low",
    "wave": 3,
    "acceptance": "Google Fonts loaded with next/font"
  },
  {
    "id": "REACT-001",
    "title": "Split SettingsPageContent into tab components",
    "files": [
      "packages/web/src/features/settings/components/SettingsPageContent.tsx",
      "packages/web/src/features/settings/components/ProfileTab.tsx",
      "packages/web/src/features/settings/components/ThemeTab.tsx",
      "packages/web/src/features/settings/components/ConversationsTab.tsx"
    ],
    "domain": "react",
    "severity": "medium",
    "effort": "medium",
    "wave": 2,
    "acceptance": "3 tab components <150 LOC each"
  },
  {
    "id": "REACT-002",
    "title": "Remove CartContext (replace with server-fetched count)",
    "files": [
      "packages/web/src/contexts/CartContext.tsx",
      "packages/web/src/components/layout/Header.tsx"
    ],
    "domain": "react",
    "severity": "low",
    "effort": "medium",
    "wave": 2,
    "acceptance": "CartContext removed, cart count fetched in layout server component"
  },
  {
    "id": "REACT-003",
    "title": "Replace index keys with stable IDs in message lists",
    "files": ["packages/web/src/features/agent/components/AgentChatMessages.tsx"],
    "domain": "react",
    "severity": "medium",
    "effort": "low",
    "wave": 1,
    "acceptance": "Messages keyed by message.id, not array index"
  },
  {
    "id": "API-007",
    "title": "Add rate limiting middleware",
    "files": ["packages/web/middleware.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "medium",
    "wave": 3,
    "acceptance": "100 req/min per IP, 429 status with retry headers"
  },
  {
    "id": "API-008",
    "title": "Add security headers middleware",
    "files": ["packages/web/middleware.ts"],
    "domain": "api",
    "severity": "medium",
    "effort": "low",
    "wave": 3,
    "acceptance": "X-Content-Type-Options, X-Frame-Options, CSP headers set"
  },
  {
    "id": "TS-012",
    "title": "Add discriminated unions for enums",
    "files": ["packages/web/src/domain/entities.ts"],
    "domain": "ts",
    "severity": "low",
    "effort": "medium",
    "wave": 3,
    "acceptance": "Exhaustiveness checks with never type"
  },
  {
    "id": "TS-013",
    "title": "Replace any with unknown in error handlers",
    "files": ["packages/web/src/lib/api/errorHandler.ts"],
    "domain": "ts",
    "severity": "low",
    "effort": "low",
    "wave": 2,
    "acceptance": "All catch blocks use unknown, type guard before access"
  },
  {
    "id": "DEAD-001",
    "title": "Remove unused barrel exports",
    "files": ["packages/web/src/components/index.ts"],
    "domain": "core",
    "severity": "low",
    "effort": "low",
    "wave": 3,
    "acceptance": "Only used components exported"
  },
  {
    "id": "DEAD-002",
    "title": "Remove or implement moderation feature",
    "files": ["packages/web/src/lib/validation/moderation.ts"],
    "domain": "core",
    "severity": "medium",
    "effort": "medium",
    "wave": 3,
    "acceptance": "Dead code removed if feature disabled, or tests added if enabled"
  }
]
